class Canvas2D{constructor(a){this.items=[],this.events={},this.isPaused=!1,this.lastEvent=null,this.checkSettings(a),this.frameCounter=0,this.startExecution()}checkSettings(a){const b=this;let{background:c,items:d,globalEvents:e}=a;const f=document.getElementById(a.id);b.canvas=()=>f;const g=f.getContext("2d");b.ctx=g,b.globalEvents=e,d.forEach(a=>b.registerNewItem(a)),b.registerNewEvents(),b.adaptFrame()}registerNewItem(a){const b=()=>this;a.origin=b,a.shape.origin=b,a.physics.origin=b,a.events.forEach(a=>a.origin=b),a.belongsTo=()=>this,this.items.push(new Item2D(a))}registerNewEvents(){const a=this,b=(b,c)=>{"undefined"==typeof a.events[b]&&(a.events[b]=[],a.canvas().addEventListener(b,a.inputHandler.bind(this))),Array.isArray(a.events[b])&&!a.events[b].includes(c)&&a.events[b].push(c)};a.globalEvents.forEach(a=>{b(a.type,-1)}),a.items.forEach((a,c)=>{a.e.forEach(a=>{b(a.type,c)})})}clearEvents(){}inputHandler(a){this.lastEvent=a;const b=a.type,c=this.events[b];c.forEach(a=>{0<=a?this.items[a].filterEvents(b).forEach(a=>a.checkIfTriggered()):this.globalEvents.filter(a=>a.type==b).forEach(a=>a.callback.call(this))})}startExecution(){this.orderOfExecution()}orderOfExecution(){this.adaptFrame(),this.isPaused||this.itemLogic(),this.drawFrame(),this.frameCounter++,requestAnimationFrame(this.orderOfExecution.bind(this))}adaptFrame(){const a=this.canvas(),{innerWidth:b,innerHeight:c}=window;(a.width!=b||a.height!=c)&&(a.width=b,a.height=c)}itemLogic(){this.items.forEach(a=>{a.physicStep(),a.onFrame.call(this,a)})}drawFrame(){const{width:a,height:b}=this.canvas();this.ctx.fillRect(0,0,a,b),this.items.forEach(a=>a.renderToCanvas())}get i(){return this.items}}class Item2D{constructor(a){const b=this,c=()=>this;b.belongsTo=a.belongsTo,b.origin=a.origin,a.shape.belongsTo=c,a.physics.belongsTo=c,a.events.forEach(a=>a.belongsTo=c),b.events=[],b.isHidden=!1,b.onFrame="function"==typeof a.onFrame?a.onFrame:function(){};const{shape:d,physics:e,events:f,onAwake:g}=a;b.pos=a.shape.args.slice(0,2),b.shape=new Shape2D(d),b.physics=new Physics2D(e),f.forEach(a=>{b.events.push(new Event2D(a))}),"function"==typeof g?g.call(b.origin,b):void 0}get xy(){return this.pos}set xy(a){this.x=a[0],this.y=a[1]}get x(){return this.pos[0]}set x(a){this.pos[0]=a}get y(){return this.pos[1]}set y(a){this.pos[1]=a}get s(){return this.shape}get sdf(){return this.s.df}get sc(){return this.s.c}set sc(a){this.s.c=a}get scw(){return this.s.cw}set scw(a){this.s.cw=a,this.s.render()}get sch(){return this.s.ch}set sch(a){this.s.ch=a,this.s.render()}get scr(){return this.s.cr}set scr(a){this.s.cr=a,this.s.render()}get shapeCenter(){return this.s.center}get p(){return this.physics}get pe(){return this.p.e}set pe(a){this.p.e=a}get pa(){return this.p.a}set pa(a){this.p.a=a}get pax(){return this.p.ax}set pax(a){this.p.ax=a}get pay(){return this.p.ay}set pay(a){this.p.ay=a}get pg(){return this.p.g}set pg(a){this.p.g=a}get pb(){return this.p.b}set pb(a){this.p.b=a}get pf(){return this.p.f}set pf(a){this.p.f=a}physicStep(){this.p.step()}get e(){return this.events}filterEvents(a){return this.e.filter(b=>b.t==a)}renderToCanvas(){const a=this;if(!this.isHidden){const b="arc"==a.sdf?[2*a.sc,2*a.sc]:a.sc;this.origin().ctx.drawImage(this.s.i,...this.xy,...b)}}}class Shape2D{constructor(a){const b=this;b.belongsTo=a.belongsTo,b.origin=a.origin;let c=a.args;b.preRender={image:document.createElement("canvas"),ctx:null,draw:{function:null,args:null}},b.preRender.ctx=b.i.getContext("2d"),b.preRender.draw.function=a.function,b.preRender.draw.args="fillRect"==b.df?[0,0,...c.slice(2)]:[c[2],c[2],...c.slice(2)],b.c="fillRect"==b.df?c.slice(2):c[2]}get p(){return this.preRender}get d(){return this.preRender.draw}get df(){return this.preRender.draw.function}set df(a){this.preRender.draw.function=a}get da(){return this.preRender.draw.args}set da(a){this.preRender.draw.args=a}get i(){return this.preRender.image}get iw(){return this.preRender.image.width}set iw(a){this.preRender.image.width=a}get ih(){return this.preRender.image.height}set ih(a){this.preRender.image.height=a}get ctx(){return this.preRender.ctx}get center(){const a=this.belongsTo(),[b,c]=a.xy;return"arc"==this.df&&"undefined"!=typeof this.cr?[b+this.cr,c+this.cr]:void 0}get c(){return"fillRect"==this.df?this.boxCollider:this.circleCollider}set c(a){"fillRect"==this.df?(this.cw=a,this.ch=a):this.cr=a,this.render()}get cw(){return"fillRect"==this.df?this.boxCollider[0]:void 0}set cw(a){const b=this;"fillRect"==b.df&&(a=1<a?a:1,b.boxCollider[0]=a,b.da[2]=a,b.iw=a,b.belongsTo().e.forEach(b=>b.h[0]=a))}get ch(){return"fillRect"==this.df?this.boxCollider[1]:void 0}set ch(a){const b=this;"fillRect"==b.df&&(a=1<a?a:1,b.boxCollider[1]=a,b.da[3]=a,b.ih=a,b.belongsTo().e.forEach(b=>b.h[1]=a))}get cr(){return"arc"==this.df?this.circleCollider:void 0}set cr(a){const b=this;if("arc"==b.df){const c=b.belongsTo(),d=b.center;a=1<a?a:1,b.circleCollider=a,b.da[0]=a+.5,b.da[1]=a+.5,b.da[2]=a,b.iw=2*a+1.6,b.ih=2*a+1.6,"undefined"!=typeof d&&(c.xy=[d[0]-b.cr,d[1]-b.cr]),c.e.forEach(b=>b.h=a)}}render(){this.clearImage();const a=this.ctx;a.fillStyle="white",a.strokeStyle="white",a.beginPath(),a[this.df](...this.da),a.fill(),a.stroke()}clearImage(){this.ctx.clearRect(0,0,this.iw,this.ih)}}class Physics2D{constructor(a){const b=this;b.belongsTo=a.belongsTo,b.origin=a.origin;let{enable:c,acc:d,gravity:e,bounce:f,friction:g}=a;b.enable="undefined"!=typeof c&&c,b.acc="undefined"==typeof d?[0,0]:d,b.gravity="undefined"==typeof e?9.82:e,b.bounce="undefined"==typeof f?0:f,b.friction="undefined"==typeof g?0:g}get e(){return this.enable}set e(a){this.enable=a}get a(){return this.acc}set a(a){this.acc=a}get ax(){return this.acc[0]}set ax(a){this.acc[0]=a}get ay(){return this.acc[1]}set ay(a){this.acc[1]=a}get g(){return this.gravity}set g(a){this.gravity=a}get b(){return this.bounce}set b(a){this.bounce=a}get f(){return this.friction}set f(a){this.friction=a}hBounce(){this.ax*=-1*this.b}vBounce(){this.ay*=-1*this.b}reverseGravity(){this.g*=-1}step(){const a=this,b=a.belongsTo(),c=1/60;a.e&&(b.y+=a.ay+a.g*c,a.ay+=a.g*c,b.x+=a.ax,a.ax*=1-a.f)}}class Event2D{constructor(a){const b=this;b.belongsTo=a.belongsTo,b.origin=a.origin;const{type:c,callback:d}=a;let{hitbox:e,assist:f,offset:g}=a;b.type=c,"undefined"==typeof e&&(e=b.belongsTo().sc),b.hitbox=e,b.assist="number"==typeof f?f:0,b.offset="number"==typeof g?g:0,b.callback=d}get t(){return this.type}set t(a){this.type=a}get h(){return this.hitbox}set h(a){this.hitbox=a}get hw(){if("fillRect"==this.belongsTo().sdf)return this.hitbox[0]}set hw(a){"fillRect"==this.belongsTo().sdf&&(this.hitbox[0]=a)}get hh(){if("fillRect"==this.belongsTo().sdf)return this.hitbox[1]}set hh(a){"fillRect"==this.belongsTo().sdf&&(this.hitbox[1]=a)}get hr(){if("arc"==this.belongsTo().sdf)return this.hitbox}set hr(a){"arc"==this.belongsTo().sdf&&(this.hitbox=a)}get a(){return this.assist}set a(a){this.assist=a}get c(){return this.callback}set c(a){this.callback=a}get o(){return this.offset}set o(a){this.offset=a}checkMouse(){const a=this.origin(),b=this.belongsTo(),c=a.lastEvent,d=[c.clientX,c.clientY];if("fillRect"==this.belongsTo().sdf){const[a,c,e,f]=[...[-this.a,this.a+this.hw].map(a=>a+this.o+b.x),...[-this.a,this.hh+this.a].map(a=>a+this.o+b.y)];return a<d[0]&&c>d[0]&&e<d[1]&&f>d[1]}else{const a=b.shapeCenter.map(a=>a+this.o),c=this.hr+this.a;return Math.sqrt((d[0]-a[0])**2+(d[1]-a[1])**2)<=c}}checkIfTriggered(){const a=this.origin();"undefined"!=typeof a.lastEvent&&this.checkMouse()&&this.c.call(this.origin(),this.belongsTo(),this)}}