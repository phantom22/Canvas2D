class Canvas2D{constructor(a){this.items=[],this.events={},this.isPaused=!1,this._hidePointer=!1,this.lastEvent=null,this.checkSettings(a),this.frameCounter=0,this.startExecution()}checkSettings(a){const b=this;let{background:c,items:d,globalEvents:e}=a;const f=document.getElementById(a.id);b.canvas=()=>f;const g=f.getContext("2d");b.ctx=g,b.globalEvents=e,d.forEach(a=>b.registerNewItem(a)),b.registerNewEvents(),b.adaptFrame()}registerNewItem(a){const b=()=>this;a.origin=b,a.shape.origin=b,a.physics.origin=b,a.events.forEach(a=>a.origin=b),a.belongsTo=()=>this,this.items.push(new Item2D(a))}registerNewEvents(){const a=this,b=(b,c)=>{"undefined"==typeof a.events[b]&&(a.events[b]=[],a.canvas().addEventListener(b,a.inputHandler.bind(this))),Array.isArray(a.events[b])&&!a.events[b].includes(c)&&a.events[b].push(c)};a.globalEvents.forEach(a=>{b(a.type,-1)}),a.items.forEach((a,c)=>{a.e.forEach(a=>{b(a.type,c)})})}clearEvents(){}inputHandler(a){this.lastEvent=a;const b=a.type,c=this.events[b];c.forEach(a=>{0<=a?this.items[a].filterEvents(b).forEach(a=>a.fireIfTriggered()):this.globalEvents.filter(a=>a.type==b).forEach(a=>a.callback.call(this))})}startExecution(){this.orderOfExecution()}orderOfExecution(){this.adaptFrame(),this.isPaused||this.itemLogic(),this.drawFrame(),this.frameCounter++,requestAnimationFrame(this.orderOfExecution.bind(this))}adaptFrame(){const a=this.canvas(),{innerWidth:b,innerHeight:c}=window;(a.width!=b||a.height!=c)&&(a.width=b,a.height=c,this.items.forEach(a=>a.updateBounds()))}itemLogic(){this.items.forEach(a=>{a.physicStep(),a.onFrame.call(this,a)})}drawFrame(){const{width:a,height:b}=this.canvas();this.ctx.fillRect(0,0,a,b),this.items.forEach(a=>a.renderToCanvas())}get i(){return this.items}togglePointer(){const a=this.canvas();this._hidePointer=!(!1!=this._hidePointer),a.style.cursor=this._hidePointer?"none":""}}class Event2D{constructor(a){const b=this;b.belongsTo=a.belongsTo,b.origin=a.origin;const{type:c,callback:d}=a;let{hitbox:e,assist:f,offset:g}=a;b.type=c,"undefined"==typeof e&&(e=b.belongsTo().sc),b.hitbox=e,b.assist="number"==typeof f?f:0,b.offset="number"==typeof g?g:0,b.callback=d}get t(){return this.type}set t(a){this.type=a}get h(){return this.hitbox}set h(a){this.hitbox=a}get hw(){return"fillRect"==this.belongsTo().sdf?this.hitbox[0]:void 0}set hw(a){"fillRect"==this.belongsTo().sdf&&(this.hitbox[0]=a)}get hh(){return"fillRect"==this.belongsTo().sdf?this.hitbox[1]:void 0}set hh(a){"fillRect"==this.belongsTo().sdf&&(this.hitbox[1]=a)}get hr(){return"arc"==this.belongsTo().sdf?this.hitbox:void 0}set hr(a){"arc"==this.belongsTo().sdf&&(this.hitbox=a)}get a(){return this.assist}set a(a){this.assist=a}get c(){return this.callback}set c(a){this.callback=a}get o(){return this.offset}set o(a){this.offset=a}checkMouse(){const a=this.origin(),b=this.belongsTo(),c=a.lastEvent,d=[c.clientX,c.clientY],{assist:e,hw:f,offset:g,hh:h,hr:i}=this;if("fillRect"==this.belongsTo().sdf){const[a,c,i,j]=[...[-e,f+e].map(a=>a+g+b.x),...[-e,h+e].map(a=>a+g+b.y)];return a<d[0]&&c>d[0]&&i<d[1]&&j>d[1]}else{const a=b.shapeCenter.map(a=>a+g);return Math.sqrt((d[0]-a[0])**2+(d[1]-a[1])**2)<=i+e}}fireIfTriggered(){const a=this.origin();"undefined"!=typeof a.lastEvent&&this.checkMouse()&&this.c.call(a,this.belongsTo(),this)}}class Item2D{constructor(a){const b=this,c=()=>this;b.belongsTo=a.belongsTo,b.origin=a.origin,a.shape.belongsTo=c,a.physics.belongsTo=c,a.events.forEach(a=>a.belongsTo=c),b.events=[],b._bounds={x:null,y:null},b.isHidden=!1,b.onFrame="function"==typeof a.onFrame?a.onFrame:function(){};const{shape:d,physics:e,events:f,onAwake:g}=a;b.pos=a.shape.args.slice(0,2),b.shape=new Shape2D(d),b.physics=new Physics2D(e),f.forEach(a=>{b.events.push(new Event2D(a))}),"function"==typeof g?g.call(b.origin,b):void 0}get xy(){return this.pos}set xy(a){this.x=a[0],this.y=a[1]}get x(){return this.pos[0]}set x(a){this.pos[0]=a}get y(){return this.pos[1]}set y(a){this.pos[1]=a}get s(){return this.shape}get sdf(){return this.s.df}get sc(){return this.s.c}set sc(a){this.s.c=a}get scw(){return this.s.cw}set scw(a){this.s.cw=a,this.s.render()}get sch(){return this.s.ch}set sch(a){this.s.ch=a,this.s.render()}get scr(){return this.s.cr}set scr(a){this.s.cr=a,this.s.render()}get shapeCenter(){return this.s.center}get p(){return this.physics}get pe(){return this.p.e}set pe(a){this.p.e=a}get pa(){return this.p.a}set pa(a){this.p.a=a}get pax(){return this.p.ax}set pax(a){this.p.ax=a}get pay(){return this.p.ay}set pay(a){this.p.ay=a}get pg(){return this.p.g}set pg(a){this.p.g=a}get pb(){return this.p.b}set pb(a){this.p.b=a}get pf(){return this.p.f}set pf(a){this.p.f=a}physicStep(){this.p.step()}get e(){return this.events}filterEvents(a){return this.e.filter(b=>b.t==a)}renderToCanvas(){const a=this;if(!this.isHidden){const b="arc"==a.sdf?[2*a.sc,2*a.sc]:a.sc;this.origin().ctx.drawImage(this.s.i,...this.xy,...b)}}keepInBounds(){const a=(a,b)=>b[0]>a?0:a>b[1]?1:-1,b=a(this.x,this._bounds.x),c=a(this.y,this._bounds.y);return-1<b&&(this.x=this._bounds.x[b],this.physics.hBounce()),-1<c&&(this.y=this._bounds.y[c],this.physics.vBounce()),-2==b+c}updateBounds(a){const b=this,{x:c,y:d}="undefined"==typeof a?{x:!0,y:!0}:a,{width:e,height:f}=b.origin().canvas(),g="fillRect"==b.sdf;if(c){const a=g?b.scw:2*b.scr;b._bounds.x=[0,e-a]}if(d){const a=g?b.sch/2:2*b.scr;b._bounds.y=[0,f-a]}}}class Physics2D{constructor(a){const b=this;b.belongsTo=a.belongsTo,b.origin=a.origin;let{enable:c,acc:d,gravity:e,bounce:f,friction:g,onCollision:h}=a;b.enable="undefined"!=typeof c&&c,b.acc="undefined"==typeof d?[0,0]:d,b.gravity="undefined"==typeof e?9.82:e,b.bounce="undefined"==typeof f?0:f,b.friction="undefined"==typeof g?0:g,b.onCollision="function"==typeof h?h:function(){},b._maxAcc=3800}get e(){return this.enable}set e(a){this.enable=a}get a(){return this.acc}set a(a){this.acc=a}get ax(){return this.acc[0]}set ax(a){this.acc[0]=Math.abs(a)<=this._maxAcc?a:this._maxAcc*Math.sign(a)}get ay(){return this.acc[1]}set ay(a){this.acc[1]=Math.abs(a)<=this._maxAcc?a:this._maxAcc*Math.sign(a)}get g(){return this.gravity}set g(a){this.gravity=a}get b(){return this.bounce}set b(a){this.bounce=a}get f(){return this.friction}set f(a){this.friction=a}hBounce(){this.ax*=-1*this.b}vBounce(){this.ay*=-1*this.b}reverseGravity(){this.g*=-1}step(){const a=this,b=a.belongsTo(),c=1/60;let{y:d,x:e}=b,{ay:f,ax:g,friction:h,gravity:i}=a;a.enable&&(e+=g*c,g*=1-h,d+=f*c+i*c,f+=i*c),b.keepInBounds()?(b.x=e,a.ax=g,b.y=d,a.ay=f):a.onCollision.call(a.origin(),b,this)}}class Shape2D{constructor(a){const b=this;b.belongsTo=a.belongsTo,b.origin=a.origin;let c=a.args;b.preRender={image:document.createElement("canvas"),ctx:null,draw:{function:null,args:null}},b.preRender.ctx=b.i.getContext("2d"),b.preRender.draw.function=a.function,b.preRender.draw.args="fillRect"==b.df?[0,0,...c.slice(2)]:[c[2],c[2],...c.slice(2)],b.c="fillRect"==b.df?c.slice(2):c[2]}get p(){return this.preRender}get d(){return this.preRender.draw}get df(){return this.preRender.draw.function}set df(a){this.preRender.draw.function=a}get da(){return this.preRender.draw.args}set da(a){this.preRender.draw.args=a}get i(){return this.preRender.image}get iw(){return this.preRender.image.width}set iw(a){this.preRender.image.width=a}get ih(){return this.preRender.image.height}set ih(a){this.preRender.image.height=a}get ctx(){return this.preRender.ctx}get center(){const a=this.belongsTo(),[b,c]=a.xy,d=this.cr;return"arc"==this.df&&"undefined"!=typeof this.cr?[b+d,c+d]:void 0}get c(){return"fillRect"==this.df?this.boxCollider:this.circleCollider}set c(a){"fillRect"==this.df?(this.cw=a,this.ch=a):this.cr=a,this.render()}get cw(){return"fillRect"==this.df?this.boxCollider[0]:void 0}set cw(a){const b=this,c=b.belongsTo();"fillRect"==b.df&&(a=1<a?a:1,b.boxCollider[0]=a,b.da[2]=a,b.iw=a,c.events.forEach(b=>b.h[0]=a),"undefined"!=typeof c.s&&c.updateBounds({x:!0}))}get ch(){return"fillRect"==this.df?this.boxCollider[1]:void 0}set ch(a){const b=this,c=b.belongsTo();"fillRect"==b.df&&(a=1<a?a:1,b.boxCollider[1]=a,b.da[3]=a,b.ih=a,c.events.forEach(b=>b.h[1]=a),"undefined"!=typeof c.s&&c.updateBounds({y:!0}))}get cr(){return"arc"==this.df?this.circleCollider:void 0}set cr(a){const b=this,c=b.belongsTo();if("arc"==b.df){const d=b.center;a=1<a?a:1,b.circleCollider=a,b.da[0]=a+.5,b.da[1]=a+.5,b.da[2]=a,b.iw=2*a+1.2,b.ih=2*a+1.2,"undefined"!=typeof d&&(c.xy=[d[0]-b.cr,d[1]-b.cr]),c.events.forEach(b=>b.h=a),"undefined"!=typeof c.s&&c.updateBounds()}}render(){this.clearImage();const a=this.ctx;a.fillStyle="white",a.strokeStyle="white",a.beginPath(),a[this.df](...this.da),a.fill(),a.stroke()}clearImage(){this.ctx.clearRect(0,0,this.iw,this.ih)}}